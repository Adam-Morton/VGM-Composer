<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Project</title>
<link rel="stylesheet" href="/style.css" />
</head>
<style>
  body {
	position: relative;
	min-height: 100vh;
	overflow-x: hidden;
  }  

  body::before {
	content: '';
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	z-index: -1; /* behind all content */
	background: var(--page-bg) center/cover no-repeat;
	filter: blur(30px) brightness(0.8); /* blur + dim for readability */
	opacity: 0.7; /* semi-transparent */
	<!-- transition: background 0.3s ease; /* smooth transition if image changes */ -->
  }
  
#site-footer {
  width: 100%;
  display: flex;
  justify-content: center; /* center child footer horizontally */
}

#site-footer footer {
  text-align: center;
}

</style>

<body>
<div class="page-wrapper">
<header id="site-header"></header>
<section class="hero" id="hero"></section>
<section id="project-details">
  <p style="text-align:center;">Loading project...</p>
</section>

<div id="site-footer"></div>

<script>
async function loadHTML(id, url) {
	const res = await fetch(url);
	const html = await res.text();
	const container = document.getElementById(id);
	container.innerHTML = html;

	// Re-run any <script> tags in the loaded HTML
	container.querySelectorAll("script").forEach(oldScript => {
		const newScript = document.createElement("script");
		if (oldScript.src) {
			newScript.src = oldScript.src;
		} else {
			newScript.textContent = oldScript.textContent;
		}
		document.body.appendChild(newScript);
		oldScript.remove();
	});
}

async function fetchJSON(url) {
	const res = await fetch(url);
	return await res.json();
}

function formatTime(seconds) {
	if (isNaN(seconds)) return '0:00';
	const m = Math.floor(seconds / 60);
	const s = Math.floor(seconds % 60).toString().padStart(2, '0');
	return `${m}:${s}`;
}

/* ----------------------------------------
   Hamburger Menu Init
---------------------------------------- */
function initHamburger() {
	const menuToggle = document.querySelector('.menu-toggle');
	const nav = document.querySelector('nav');
	if (!menuToggle || !nav) return;

	menuToggle.addEventListener('click', () => {
		nav.classList.toggle('active');
	});
}
/* ----------------------------------------
   Custom Audio Player
---------------------------------------- */
function setupCustomAudioPlayer(audioPath) {
	const container = document.createElement('div');
	container.className = 'custom-audio-player';

	const playIcon = `<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>`;
	const pauseIcon = `<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6zm8-14v14h4V5z"/></svg>`;
	const volumeOnIcon = `<svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3z"/><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v8.06c1.48-.74 2.5-2.26 2.5-4.03z"/></svg>`;
	const volumeMuteIcon = `<svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3z"/><line x1="19" y1="5" x2="5" y2="19" stroke="currentColor" stroke-width="2"/></svg>`;

	container.innerHTML = `
		<button id="play-pause">${playIcon}</button>
		<input type="range" id="progress" value="0" min="0" max="100" step="1" />
		<span class="timestamp" id="timestamp">0:00 / 0:00</span>
		<button id="mute-unmute">${volumeOnIcon}</button>
		<input type="range" id="volume" value="100" min="0" max="100" step="1" />
		<audio id="audio" src="${audioPath}" loop preload="metadata"></audio>
	`;

	const audio = container.querySelector('#audio');
	const playPauseBtn = container.querySelector('#play-pause');
	const progress = container.querySelector('#progress');
	const volume = container.querySelector('#volume');
	const muteUnmuteBtn = container.querySelector('#mute-unmute');
	const timestamp = container.querySelector('#timestamp');

	function updatePlayButton() {
		playPauseBtn.innerHTML = audio.paused ? playIcon : pauseIcon;
	}

	function updateMuteButton() {
		muteUnmuteBtn.innerHTML = audio.muted || audio.volume === 0 ? volumeMuteIcon : volumeOnIcon;
	}

	playPauseBtn.addEventListener('click', () => {
		audio.paused ? audio.play() : audio.pause();
		updatePlayButton();
	});

	audio.addEventListener('timeupdate', () => {
		if (audio.duration) {
			progress.value = (audio.currentTime / audio.duration) * 100;
			timestamp.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
		}
	});

	audio.addEventListener('loadedmetadata', () => {
		timestamp.textContent = `${formatTime(0)} / ${formatTime(audio.duration)}`;
	});

	progress.addEventListener('input', () => {
		if (audio.duration) audio.currentTime = (progress.value / 100) * audio.duration;
	});

	volume.addEventListener('input', () => {
		audio.volume = volume.value / 100;
		audio.muted = audio.volume === 0;
		updateMuteButton();
	});

	muteUnmuteBtn.addEventListener('click', () => {
		audio.muted = !audio.muted;
		updateMuteButton();
	});

	updatePlayButton();
	updateMuteButton();

	return container;
}

/* ----------------------------------------
   Render Functions
---------------------------------------- */
function renderHero(project) {
	const hero = document.getElementById('hero');
	hero.innerHTML = `
		<div style="text-align:center; margin:1rem 0;">
			<h1>${project.title}</h1>
			${project.description ? `<p>${project.description}</p>` : ''}
			${project.cta?.link ? `<a href="${project.cta.link}" class="btn">${project.cta.text || 'Visit Project'}</a>` : ''}
		</div>
	`;
}

function renderProjectDetails(project, projectSlug) {
	const container = document.getElementById('project-details');
	const folder = `../${projectSlug}/`;
	const mainImage = project.image || `${folder}cover.png`;

	let html = `
		<img src="${mainImage}" alt="${project.title}" style="max-width:600px; width:100%; display:block; margin: 1rem auto;">
		<div id="custom-audio-container" style="text-align:center;"></div>
	`;

	if (project.details) {
		const d = project.details;
		html += `<div style="text-align:center; margin-top:1.5rem;">`;
		if (d.summary) html += `<p>${d.summary}</p>`;
		if (d.tech) html += `<p><strong>Tech:</strong> ${d.tech.join(', ')}</p>`;
		if (d.date) html += `<p><strong>Date:</strong> ${d.date}</p>`;
		if (d.role) html += `<p><strong>Role:</strong> ${d.role}</p>`;
		if (d.client) html += `<p><strong>Client:</strong> ${d.client}</p>`;
		html += `</div>`;
	}

	if (project.gallery?.length) {
		html += `<div class="project-gallery">`;
		project.gallery.forEach(img => {
			html += `<img src="../${img}" alt="${project.title}">`;
		});
		html += `</div>`;
	}

	if (project.video) {
		html += `
			<div class="responsive-video">
				<iframe src="${project.video}" frameborder="0" allowfullscreen></iframe>
			</div>
		`;
	}

	html += `
		<div style="text-align:center; margin-top:2rem;">
			<a href="/" class="btn">Back to Home</a>
		</div>
	`;

	if (project.testimonials?.length) {
		html += `<div style="margin-top:2rem; text-align:center;"><h2>Testimonials</h2>`;
		project.testimonials.forEach(t => {
			html += `<p><strong>${t.author} // ${t.role}</strong></p><p><em>"${t.text}"</em></p>`;
		});
		html += `</div>`;
	}

	container.innerHTML = html;

	const audioPath = project.audio || `${folder}audio.wav`;
	const audioContainer = document.getElementById('custom-audio-container');
	audioContainer.appendChild(setupCustomAudioPlayer(audioPath));
}

/* ----------------------------------------
   Init
---------------------------------------- */
async function init() {
	// 1️⃣ Load header and footer
	await loadHTML('site-header', '/header.html');
	await loadHTML('site-footer', '/footer.html');

	// ✅ Now the header is in the DOM, initialize hamburger
	const menuToggle = document.querySelector('.menu-toggle');
	const nav = document.querySelector('nav');

	if (menuToggle && nav) {
		menuToggle.addEventListener('click', () => {
			nav.classList.toggle('open'); // matches your CSS
		});
	}
  
	// 2️⃣ Determine current project
	const params = new URLSearchParams(window.location.search);
	const projectSlug = params.get('name') || window.location.pathname.split('/').filter(Boolean).pop();

	// 3️⃣ Load project data
	const data = await fetchJSON('/data.json');
	const project = data.projects.find(p => (p.slug || p.title.toLowerCase().replace(/\s+/g,'-')) === projectSlug);

	if (!project) {
		document.getElementById('project-details').innerHTML =
			'<p style="text-align:center;">Project not found. <a href="/" class="btn">Back to home</a></p>';
		return;
	}

	// 4️⃣ Set blurred background
	const heroImage = project.image || `../${projectSlug}/cover.png`;
	document.body.style.setProperty('--page-bg', `url('${heroImage}')`);

	// 5️⃣ Render hero and project details
	renderHero(project, projectSlug);
	renderProjectDetails(project, projectSlug);
}


init();

// mobile menu toggle
const menuToggle = document.querySelector('.menu-toggle');
const nav = document.querySelector('#site-header nav');

menuToggle.addEventListener('click', () => {
	nav.classList.toggle('open');
});

</script>

</div>
</body>
</html>
